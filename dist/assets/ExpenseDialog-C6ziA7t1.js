import{c as oe,r,j as e,g as F,i as A,h as ne,s as ie}from"./index-BczRz4ky.js";import{P as R,a as P,f as z,b as O,c as V,d as q,e as L}from"./Layout-Cjs2lFUa.js";import{D as B,a as U,b as Z,c as _,d as H,P as le,e as $}from"./dialog-BsWlHXv2.js";import{B as l}from"./crystal-icon-BR5-Rl_Z.js";import{L as u,I as G}from"./label-03Zcm6W0.js";import{S as J,a as K,b as Q,d as W,e as X}from"./select-DrkzBdXl.js";import{u as Y}from"./useCurrency-Ji0yYFK2.js";import{I as ce}from"./IncomeSourceDialog-BpGFH5Ja.js";import{h as E}from"./numberInput-Di0gcIKz.js";import{r as D}from"./ru-DGv6tEtD.js";import{o as ee,Z as se,s as j,n as ae}from"./types-Cqx1EfL_.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=oe("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]),M=r.forwardRef(({className:o,...c},f)=>e.jsx("textarea",{className:F("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",o),ref:f,...c}));M.displayName="Textarea";const de=ee({sourceId:j().min(1,"Выберите источник дохода"),amount:ae().positive("Сумма должна быть положительной"),date:j().min(1,"Выберите дату"),description:j().optional()});function we({open:o,onOpenChange:c,incomeSources:f,onSave:C,editingIncome:t,onSourceCreated:g}){const{toast:v}=A(),{user:N}=ne(),{convertToRubles:y,convertFromRubles:h}=Y(),[S,p]=r.useState(""),[n,d]=r.useState(""),[i,m]=r.useState(new Date),[b,x]=r.useState(""),[I,a]=r.useState(!1),[k,T]=r.useState(!1),te=async s=>{if(!N)return;const{error:w}=await ie.from("income_sources").insert({user_id:N.id,name:s.name,frequency:s.frequency,color:s.color});w?v({title:"Ошибка создания источника",description:w.message,variant:"destructive"}):(a(!1),g==null||g(),v({title:"Источник создан",description:"Теперь выберите его из списка"}))};r.useEffect(()=>{if(o&&t){p(t.sourceId);const s=h(t.amount);d(s.toString()),m(new Date(t.date)),x(t.description||"")}else o||(p(""),d(""),m(new Date),x(""))},[o,t,h]);const re=()=>{try{const s=de.parse({sourceId:S,amount:parseFloat(n),date:i==null?void 0:i.toISOString(),description:b.trim()||void 0}),w=y(s.amount);C({sourceId:s.sourceId,amount:w,date:s.date,description:s.description}),c(!1)}catch(s){s instanceof se&&v({title:"Ошибка валидации",description:s.errors[0].message,variant:"destructive"})}};return e.jsxs(B,{open:o,onOpenChange:c,children:[e.jsxs(U,{className:"sm:max-w-[425px]",children:[e.jsxs(Z,{children:[e.jsx(_,{children:t?"Редактировать доход":"Добавить доход"}),e.jsx(H,{children:t?"Измените данные дохода":"Запишите полученный доход"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{htmlFor:"source",children:"Источник"}),e.jsxs(J,{value:S,onValueChange:s=>{s==="create-new"?a(!0):p(s)},children:[e.jsx(K,{children:e.jsx(Q,{placeholder:"Выберите источник"})}),e.jsxs(W,{className:"bg-background z-50",children:[f.map(s=>e.jsx(X,{value:s.id,children:s.name},s.id)),e.jsxs("div",{className:"relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-accent hover:text-accent-foreground border-t mt-1",onClick:s=>{s.stopPropagation(),a(!0)},children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Создать новый источник"})]})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{htmlFor:"amount",children:"Сумма"}),e.jsx(G,{id:"amount",inputMode:"decimal",placeholder:"50000",value:n,onChange:s=>E(s.target.value,d)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{children:"Дата"}),e.jsxs(R,{open:k,onOpenChange:T,children:[e.jsx(P,{asChild:!0,children:e.jsxs(l,{variant:"outline",className:F("justify-start text-left font-normal",!i&&"text-muted-foreground"),children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),i?z(i,"dd MMMM yyyy",{locale:D}):e.jsx("span",{children:"Выберите дату"})]})}),e.jsxs(V,{className:"w-auto p-0 bg-popover",align:"start",children:[e.jsx(q,{mode:"single",selected:i,onSelect:m,initialFocus:!0,locale:D,className:"pointer-events-auto"}),e.jsx(L,{}),e.jsxs("div",{className:"flex gap-2 p-3 pt-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{m(new Date)},className:"flex-1",children:"Сегодня"}),e.jsx(l,{size:"sm",onClick:()=>T(!1),className:"flex-1",children:"ОК"})]})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{htmlFor:"description",children:"Описание (необязательно)"}),e.jsx(M,{id:"description",placeholder:"Дополнительная информация...",value:b,onChange:s=>x(s.target.value),rows:3})]})]}),e.jsxs($,{children:[e.jsx(l,{variant:"outline",onClick:()=>c(!1),children:"Отмена"}),e.jsx(l,{onClick:re,children:t?"Сохранить":"Добавить"})]})]}),e.jsx(ce,{open:I,onOpenChange:a,onSave:te})]})}const me=ee({categoryId:j().min(1,"Выберите категорию"),amount:ae().positive("Сумма должна быть положительной"),date:j().min(1,"Выберите дату"),description:j().optional()});function De({open:o,onOpenChange:c,categories:f,onSave:C,editingExpense:t}){const{toast:g}=A(),{convertToRubles:v,convertFromRubles:N}=Y(),[y,h]=r.useState(""),[S,p]=r.useState(""),[n,d]=r.useState(new Date),[i,m]=r.useState(""),[b,x]=r.useState(!1);r.useEffect(()=>{if(o&&t){h(t.categoryId);const a=N(t.amount);p(a.toString()),d(new Date(t.date)),m(t.description||"")}else o||(h(""),p(""),d(new Date),m(""))},[o,t,N]);const I=()=>{try{const a=me.parse({categoryId:y,amount:parseFloat(S),date:n==null?void 0:n.toISOString(),description:i.trim()||void 0}),k=v(a.amount);C({categoryId:a.categoryId,amount:k,date:a.date,description:a.description}),c(!1)}catch(a){a instanceof se&&g({title:"Ошибка валидации",description:a.errors[0].message,variant:"destructive"})}};return e.jsx(B,{open:o,onOpenChange:c,children:e.jsxs(U,{className:"sm:max-w-[425px]",children:[e.jsxs(Z,{children:[e.jsx(_,{children:t?"Редактировать расход":"Добавить расход"}),e.jsx(H,{children:t?"Измените данные расхода":"Запишите совершенный расход"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{htmlFor:"category",children:"Категория"}),e.jsxs(J,{value:y,onValueChange:h,children:[e.jsx(K,{children:e.jsx(Q,{placeholder:"Выберите категорию"})}),e.jsx(W,{className:"bg-background z-50",children:f.map(a=>e.jsxs(X,{value:a.id,children:[a.icon," ",a.name]},a.id))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{htmlFor:"amount",children:"Сумма"}),e.jsx(G,{id:"amount",inputMode:"decimal",placeholder:"1000",value:S,onChange:a=>E(a.target.value,p)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{children:"Дата"}),e.jsxs(R,{open:b,onOpenChange:x,children:[e.jsx(P,{asChild:!0,children:e.jsxs(l,{variant:"outline",className:F("justify-start text-left font-normal",!n&&"text-muted-foreground"),children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),n?z(n,"dd MMMM yyyy",{locale:D}):e.jsx("span",{children:"Выберите дату"})]})}),e.jsxs(V,{className:"w-auto p-0 bg-popover",align:"start",children:[e.jsx(q,{mode:"single",selected:n,onSelect:d,initialFocus:!0,locale:D,className:"pointer-events-auto"}),e.jsx(L,{}),e.jsxs("div",{className:"flex gap-2 p-3 pt-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{d(new Date)},className:"flex-1",children:"Сегодня"}),e.jsx(l,{size:"sm",onClick:()=>x(!1),className:"flex-1",children:"ОК"})]})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{htmlFor:"description",children:"Описание (необязательно)"}),e.jsx(M,{id:"description",placeholder:"Дополнительная информация...",value:i,onChange:a=>m(a.target.value),rows:3})]})]}),e.jsxs($,{children:[e.jsx(l,{variant:"outline",onClick:()=>c(!1),children:"Отмена"}),e.jsx(l,{onClick:I,children:t?"Сохранить":"Добавить"})]})]})})}export{be as A,De as E,we as I,M as T};
