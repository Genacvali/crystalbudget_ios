import{c as X,j as e,r,u as we,a as Pt,P as Se,b as qe,d as he,e as ue,f as Rt,g as Ne,h as $e,s as N,L as Dt,X as Lt,t as D,i as mt,S as V,k as Mt}from"./index-BczRz4ky.js";import{C as Ae,a as qt,B as P}from"./crystal-icon-BR5-Rl_Z.js";import{T as zt,a as Ot,b as Be,c as Ve}from"./tabs-US1_3Bsj.js";import{c as Bt,S as Te,a as Pe,b as Re,d as De,e as re}from"./select-DrkzBdXl.js";import{F as ge,S as Vt,f as Wt,L as at,T as Ht,C as Ft}from"./Layout-Cjs2lFUa.js";import{I as rt}from"./IncomeSourceCard-Iw41nydx.js";import{C as nt}from"./CategoryCard-DkQaFMeh.js";import{T as $t,A as ot,I as Yt,E as Ut}from"./ExpenseDialog-C6ziA7t1.js";import{D as Ye,a as Ue,b as Xe,c as Ge,d as ut,P as ve}from"./dialog-BsWlHXv2.js";import{u as Xt,L as _e,I as ke}from"./label-03Zcm6W0.js";import{P as Gt}from"./progress-DmPhu3Xe.js";import{h as it}from"./numberInput-Di0gcIKz.js";import{u as Jt}from"./useCurrency-Ji0yYFK2.js";import{T as Zt}from"./trending-down-BmG-Q5Dc.js";import{r as Kt}from"./ru-DGv6tEtD.js";import"./IncomeSourceDialog-BpGFH5Ja.js";import"./types-Cqx1EfL_.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=X("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=X("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=X("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=X("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=X("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=X("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=X("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=X("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=X("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2V5z",key:"1ivx2i"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h.01",key:"xkw8gn"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=X("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=X("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=X("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=X("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);function We({title:t,value:c,subtitle:s,icon:a,trend:n="neutral",variant:d="default"}){const i={default:"bg-card border-border",success:"bg-success/5 border-success/20",destructive:"bg-destructive/5 border-destructive/20"},h={default:"text-foreground",success:"text-success",destructive:"text-destructive"};return e.jsx(Ae,{className:Ie("hover:shadow-md transition-shadow",i[d]),children:e.jsx(qt,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1 sm:space-y-2 min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground font-medium",children:t}),e.jsx("p",{className:Ie("text-xl sm:text-3xl font-bold break-words",h[d]),children:c}),s&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s})]}),e.jsx("div",{className:Ie("p-2 sm:p-3 rounded-lg flex-shrink-0",d==="success"&&"bg-success/10",d==="destructive"&&"bg-destructive/10",d==="default"&&"bg-primary/10"),children:e.jsx(a,{className:Ie("h-4 w-4 sm:h-6 sm:w-6",h[d])})})]})})})}function Ie(...t){return t.filter(Boolean).join(" ")}function ls(t,c){return r.useReducer((s,a)=>c[s][a]??s,t)}var Je="ScrollArea",[ht]=Pt(Je),[cs,Q]=ht(Je),ft=r.forwardRef((t,c)=>{const{__scopeScrollArea:s,type:a="hover",dir:n,scrollHideDelay:d=600,...i}=t,[h,m]=r.useState(null),[b,f]=r.useState(null),[y,w]=r.useState(null),[k,M]=r.useState(null),[$,G]=r.useState(null),[W,ee]=r.useState(0),[H,ne]=r.useState(0),[F,Y]=r.useState(!1),[J,g]=r.useState(!1),v=we(c,T=>m(T)),_=Xt(n);return e.jsx(cs,{scope:s,type:a,dir:_,scrollHideDelay:d,scrollArea:h,viewport:b,onViewportChange:f,content:y,onContentChange:w,scrollbarX:k,onScrollbarXChange:M,scrollbarXEnabled:F,onScrollbarXEnabledChange:Y,scrollbarY:$,onScrollbarYChange:G,scrollbarYEnabled:J,onScrollbarYEnabledChange:g,onCornerWidthChange:ee,onCornerHeightChange:ne,children:e.jsx(Se.div,{dir:_,...i,ref:v,style:{position:"relative","--radix-scroll-area-corner-width":W+"px","--radix-scroll-area-corner-height":H+"px",...t.style}})})});ft.displayName=Je;var xt="ScrollAreaViewport",pt=r.forwardRef((t,c)=>{const{__scopeScrollArea:s,children:a,nonce:n,...d}=t,i=Q(xt,s),h=r.useRef(null),m=we(c,h,i.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),e.jsx(Se.div,{"data-radix-scroll-area-viewport":"",...d,ref:m,style:{overflowX:i.scrollbarXEnabled?"scroll":"hidden",overflowY:i.scrollbarYEnabled?"scroll":"hidden",...t.style},children:e.jsx("div",{ref:i.onContentChange,style:{minWidth:"100%",display:"table"},children:a})})]})});pt.displayName=xt;var le="ScrollAreaScrollbar",Ze=r.forwardRef((t,c)=>{const{forceMount:s,...a}=t,n=Q(le,t.__scopeScrollArea),{onScrollbarXEnabledChange:d,onScrollbarYEnabledChange:i}=n,h=t.orientation==="horizontal";return r.useEffect(()=>(h?d(!0):i(!0),()=>{h?d(!1):i(!1)}),[h,d,i]),n.type==="hover"?e.jsx(ds,{...a,ref:c,forceMount:s}):n.type==="scroll"?e.jsx(ms,{...a,ref:c,forceMount:s}):n.type==="auto"?e.jsx(gt,{...a,ref:c,forceMount:s}):n.type==="always"?e.jsx(Ke,{...a,ref:c}):null});Ze.displayName=le;var ds=r.forwardRef((t,c)=>{const{forceMount:s,...a}=t,n=Q(le,t.__scopeScrollArea),[d,i]=r.useState(!1);return r.useEffect(()=>{const h=n.scrollArea;let m=0;if(h){const b=()=>{window.clearTimeout(m),i(!0)},f=()=>{m=window.setTimeout(()=>i(!1),n.scrollHideDelay)};return h.addEventListener("pointerenter",b),h.addEventListener("pointerleave",f),()=>{window.clearTimeout(m),h.removeEventListener("pointerenter",b),h.removeEventListener("pointerleave",f)}}},[n.scrollArea,n.scrollHideDelay]),e.jsx(qe,{present:s||d,children:e.jsx(gt,{"data-state":d?"visible":"hidden",...a,ref:c})})}),ms=r.forwardRef((t,c)=>{const{forceMount:s,...a}=t,n=Q(le,t.__scopeScrollArea),d=t.orientation==="horizontal",i=Oe(()=>m("SCROLL_END"),100),[h,m]=ls("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return r.useEffect(()=>{if(h==="idle"){const b=window.setTimeout(()=>m("HIDE"),n.scrollHideDelay);return()=>window.clearTimeout(b)}},[h,n.scrollHideDelay,m]),r.useEffect(()=>{const b=n.viewport,f=d?"scrollLeft":"scrollTop";if(b){let y=b[f];const w=()=>{const k=b[f];y!==k&&(m("SCROLL"),i()),y=k};return b.addEventListener("scroll",w),()=>b.removeEventListener("scroll",w)}},[n.viewport,d,m,i]),e.jsx(qe,{present:s||h!=="hidden",children:e.jsx(Ke,{"data-state":h==="hidden"?"hidden":"visible",...a,ref:c,onPointerEnter:he(t.onPointerEnter,()=>m("POINTER_ENTER")),onPointerLeave:he(t.onPointerLeave,()=>m("POINTER_LEAVE"))})})}),gt=r.forwardRef((t,c)=>{const s=Q(le,t.__scopeScrollArea),{forceMount:a,...n}=t,[d,i]=r.useState(!1),h=t.orientation==="horizontal",m=Oe(()=>{if(s.viewport){const b=s.viewport.offsetWidth<s.viewport.scrollWidth,f=s.viewport.offsetHeight<s.viewport.scrollHeight;i(h?b:f)}},10);return je(s.viewport,m),je(s.content,m),e.jsx(qe,{present:a||d,children:e.jsx(Ke,{"data-state":d?"visible":"hidden",...n,ref:c})})}),Ke=r.forwardRef((t,c)=>{const{orientation:s="vertical",...a}=t,n=Q(le,t.__scopeScrollArea),d=r.useRef(null),i=r.useRef(0),[h,m]=r.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),b=yt(h.viewport,h.content),f={...a,sizes:h,onSizesChange:m,hasThumb:b>0&&b<1,onThumbChange:w=>d.current=w,onThumbPointerUp:()=>i.current=0,onThumbPointerDown:w=>i.current=w};function y(w,k){return gs(w,i.current,h,k)}return s==="horizontal"?e.jsx(us,{...f,ref:c,onThumbPositionChange:()=>{if(n.viewport&&d.current){const w=n.viewport.scrollLeft,k=dt(w,h,n.dir);d.current.style.transform=`translate3d(${k}px, 0, 0)`}},onWheelScroll:w=>{n.viewport&&(n.viewport.scrollLeft=w)},onDragScroll:w=>{n.viewport&&(n.viewport.scrollLeft=y(w,n.dir))}}):s==="vertical"?e.jsx(hs,{...f,ref:c,onThumbPositionChange:()=>{if(n.viewport&&d.current){const w=n.viewport.scrollTop,k=dt(w,h);d.current.style.transform=`translate3d(0, ${k}px, 0)`}},onWheelScroll:w=>{n.viewport&&(n.viewport.scrollTop=w)},onDragScroll:w=>{n.viewport&&(n.viewport.scrollTop=y(w))}}):null}),us=r.forwardRef((t,c)=>{const{sizes:s,onSizesChange:a,...n}=t,d=Q(le,t.__scopeScrollArea),[i,h]=r.useState(),m=r.useRef(null),b=we(c,m,d.onScrollbarXChange);return r.useEffect(()=>{m.current&&h(getComputedStyle(m.current))},[m]),e.jsx(jt,{"data-orientation":"horizontal",...n,ref:b,sizes:s,style:{bottom:0,left:d.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:d.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":ze(s)+"px",...t.style},onThumbPointerDown:f=>t.onThumbPointerDown(f.x),onDragScroll:f=>t.onDragScroll(f.x),onWheelScroll:(f,y)=>{if(d.viewport){const w=d.viewport.scrollLeft+f.deltaX;t.onWheelScroll(w),St(w,y)&&f.preventDefault()}},onResize:()=>{m.current&&d.viewport&&i&&a({content:d.viewport.scrollWidth,viewport:d.viewport.offsetWidth,scrollbar:{size:m.current.clientWidth,paddingStart:Me(i.paddingLeft),paddingEnd:Me(i.paddingRight)}})}})}),hs=r.forwardRef((t,c)=>{const{sizes:s,onSizesChange:a,...n}=t,d=Q(le,t.__scopeScrollArea),[i,h]=r.useState(),m=r.useRef(null),b=we(c,m,d.onScrollbarYChange);return r.useEffect(()=>{m.current&&h(getComputedStyle(m.current))},[m]),e.jsx(jt,{"data-orientation":"vertical",...n,ref:b,sizes:s,style:{top:0,right:d.dir==="ltr"?0:void 0,left:d.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":ze(s)+"px",...t.style},onThumbPointerDown:f=>t.onThumbPointerDown(f.y),onDragScroll:f=>t.onDragScroll(f.y),onWheelScroll:(f,y)=>{if(d.viewport){const w=d.viewport.scrollTop+f.deltaY;t.onWheelScroll(w),St(w,y)&&f.preventDefault()}},onResize:()=>{m.current&&d.viewport&&i&&a({content:d.viewport.scrollHeight,viewport:d.viewport.offsetHeight,scrollbar:{size:m.current.clientHeight,paddingStart:Me(i.paddingTop),paddingEnd:Me(i.paddingBottom)}})}})}),[fs,vt]=ht(le),jt=r.forwardRef((t,c)=>{const{__scopeScrollArea:s,sizes:a,hasThumb:n,onThumbChange:d,onThumbPointerUp:i,onThumbPointerDown:h,onThumbPositionChange:m,onDragScroll:b,onWheelScroll:f,onResize:y,...w}=t,k=Q(le,s),[M,$]=r.useState(null),G=we(c,v=>$(v)),W=r.useRef(null),ee=r.useRef(""),H=k.viewport,ne=a.content-a.viewport,F=ue(f),Y=ue(m),J=Oe(y,10);function g(v){if(W.current){const _=v.clientX-W.current.left,T=v.clientY-W.current.top;b({x:_,y:T})}}return r.useEffect(()=>{const v=_=>{const T=_.target;(M==null?void 0:M.contains(T))&&F(_,ne)};return document.addEventListener("wheel",v,{passive:!1}),()=>document.removeEventListener("wheel",v,{passive:!1})},[H,M,ne,F]),r.useEffect(Y,[a,Y]),je(M,J),je(k.content,J),e.jsx(fs,{scope:s,scrollbar:M,hasThumb:n,onThumbChange:ue(d),onThumbPointerUp:ue(i),onThumbPositionChange:Y,onThumbPointerDown:ue(h),children:e.jsx(Se.div,{...w,ref:G,style:{position:"absolute",...w.style},onPointerDown:he(t.onPointerDown,v=>{v.button===0&&(v.target.setPointerCapture(v.pointerId),W.current=M.getBoundingClientRect(),ee.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",k.viewport&&(k.viewport.style.scrollBehavior="auto"),g(v))}),onPointerMove:he(t.onPointerMove,g),onPointerUp:he(t.onPointerUp,v=>{const _=v.target;_.hasPointerCapture(v.pointerId)&&_.releasePointerCapture(v.pointerId),document.body.style.webkitUserSelect=ee.current,k.viewport&&(k.viewport.style.scrollBehavior=""),W.current=null})})})}),Le="ScrollAreaThumb",wt=r.forwardRef((t,c)=>{const{forceMount:s,...a}=t,n=vt(Le,t.__scopeScrollArea);return e.jsx(qe,{present:s||n.hasThumb,children:e.jsx(xs,{ref:c,...a})})}),xs=r.forwardRef((t,c)=>{const{__scopeScrollArea:s,style:a,...n}=t,d=Q(Le,s),i=vt(Le,s),{onThumbPositionChange:h}=i,m=we(c,y=>i.onThumbChange(y)),b=r.useRef(void 0),f=Oe(()=>{b.current&&(b.current(),b.current=void 0)},100);return r.useEffect(()=>{const y=d.viewport;if(y){const w=()=>{if(f(),!b.current){const k=vs(y,h);b.current=k,h()}};return h(),y.addEventListener("scroll",w),()=>y.removeEventListener("scroll",w)}},[d.viewport,f,h]),e.jsx(Se.div,{"data-state":i.hasThumb?"visible":"hidden",...n,ref:m,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...a},onPointerDownCapture:he(t.onPointerDownCapture,y=>{const k=y.target.getBoundingClientRect(),M=y.clientX-k.left,$=y.clientY-k.top;i.onThumbPointerDown({x:M,y:$})}),onPointerUp:he(t.onPointerUp,i.onThumbPointerUp)})});wt.displayName=Le;var Qe="ScrollAreaCorner",bt=r.forwardRef((t,c)=>{const s=Q(Qe,t.__scopeScrollArea),a=!!(s.scrollbarX&&s.scrollbarY);return s.type!=="scroll"&&a?e.jsx(ps,{...t,ref:c}):null});bt.displayName=Qe;var ps=r.forwardRef((t,c)=>{const{__scopeScrollArea:s,...a}=t,n=Q(Qe,s),[d,i]=r.useState(0),[h,m]=r.useState(0),b=!!(d&&h);return je(n.scrollbarX,()=>{var y;const f=((y=n.scrollbarX)==null?void 0:y.offsetHeight)||0;n.onCornerHeightChange(f),m(f)}),je(n.scrollbarY,()=>{var y;const f=((y=n.scrollbarY)==null?void 0:y.offsetWidth)||0;n.onCornerWidthChange(f),i(f)}),b?e.jsx(Se.div,{...a,ref:c,style:{width:d,height:h,position:"absolute",right:n.dir==="ltr"?0:void 0,left:n.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function Me(t){return t?parseInt(t,10):0}function yt(t,c){const s=t/c;return isNaN(s)?0:s}function ze(t){const c=yt(t.viewport,t.content),s=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,a=(t.scrollbar.size-s)*c;return Math.max(a,18)}function gs(t,c,s,a="ltr"){const n=ze(s),d=n/2,i=c||d,h=n-i,m=s.scrollbar.paddingStart+i,b=s.scrollbar.size-s.scrollbar.paddingEnd-h,f=s.content-s.viewport,y=a==="ltr"?[0,f]:[f*-1,0];return Nt([m,b],y)(t)}function dt(t,c,s="ltr"){const a=ze(c),n=c.scrollbar.paddingStart+c.scrollbar.paddingEnd,d=c.scrollbar.size-n,i=c.content-c.viewport,h=d-a,m=s==="ltr"?[0,i]:[i*-1,0],b=Bt(t,m);return Nt([0,i],[0,h])(b)}function Nt(t,c){return s=>{if(t[0]===t[1]||c[0]===c[1])return c[0];const a=(c[1]-c[0])/(t[1]-t[0]);return c[0]+a*(s-t[0])}}function St(t,c){return t>0&&t<c}var vs=(t,c=()=>{})=>{let s={left:t.scrollLeft,top:t.scrollTop},a=0;return function n(){const d={left:t.scrollLeft,top:t.scrollTop},i=s.left!==d.left,h=s.top!==d.top;(i||h)&&c(),s=d,a=window.requestAnimationFrame(n)}(),()=>window.cancelAnimationFrame(a)};function Oe(t,c){const s=ue(t),a=r.useRef(0);return r.useEffect(()=>()=>window.clearTimeout(a.current),[]),r.useCallback(()=>{window.clearTimeout(a.current),a.current=window.setTimeout(s,c)},[s,c])}function je(t,c){const s=ue(c);Rt(()=>{let a=0;if(t){const n=new ResizeObserver(()=>{cancelAnimationFrame(a),a=window.requestAnimationFrame(s)});return n.observe(t),()=>{window.cancelAnimationFrame(a),n.unobserve(t)}}},[t,s])}var Ct=ft,js=pt,ws=bt;const _t=r.forwardRef(({className:t,children:c,...s},a)=>e.jsxs(Ct,{ref:a,className:Ne("relative overflow-hidden",t),...s,children:[e.jsx(js,{className:"h-full w-full rounded-[inherit]",children:c}),e.jsx(kt,{}),e.jsx(ws,{})]}));_t.displayName=Ct.displayName;const kt=r.forwardRef(({className:t,orientation:c="vertical",...s},a)=>e.jsx(Ze,{ref:a,orientation:c,className:Ne("flex touch-none select-none transition-colors",c==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",c==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...s,children:e.jsx(wt,{className:"relative flex-1 rounded-full bg-border"})}));kt.displayName=Ze.displayName;function bs(){const{user:t}=$e(),[c,s]=r.useState(null),[a,n]=r.useState(!0);return r.useEffect(()=>{if(!t){s(null),n(!1);return}(async()=>{try{const{data:i}=await N.from("families").select("id, owner_id").eq("owner_id",t.id).maybeSingle();if(i){s(t.id),n(!1);return}const{data:h}=await N.from("family_members").select("family_id, families!inner(owner_id)").eq("user_id",t.id).maybeSingle();h&&h.families?s(h.families.owner_id):s(t.id)}catch(i){console.error("Error getting effective user ID:",i),s(t.id)}finally{n(!1)}})()},[t]),{effectiveUserId:c,loading:a}}function ys({open:t,onOpenChange:c}){const{user:s}=$e(),{effectiveUserId:a}=bs(),[n,d]=r.useState([]),[i,h]=r.useState(""),[m,b]=r.useState(!1),[f,y]=r.useState([]),[w,k]=r.useState(!1),M=r.useRef(null),$=r.useRef(null),G=r.useRef(null),W=r.useRef(null),ee=()=>{requestAnimationFrame(()=>{var g;(g=$.current)==null||g.scrollIntoView({behavior:"smooth",block:"end"})})};r.useEffect(()=>{ee()},[n,m]),r.useEffect(()=>{t&&(ee(),!w&&n.length===0&&(k(!0),d([{role:"assistant",content:"Здравствуйте. Я G.A.I.A. (Global Analytical Intelligence for Allocation) — ваш интеллектуальный ассистент CrystalBudget."}])),setTimeout(()=>{var g;(g=W.current)==null||g.focus()},500))},[t,w,n.length]);const H=async g=>{var v,_;if(!(!s||!a))for(const T of g){const A=(v=T.function)==null?void 0:v.name,o=JSON.parse(((_=T.function)==null?void 0:_.arguments)||"{}");try{switch(A){case"create_category":await N.from("categories").insert({user_id:a,name:o.name,icon:o.icon}),D({title:"Категория создана",description:`Категория "${o.name}" успешно создана`});break;case"update_category_allocation":{const{data:u}=await N.from("categories").select("id").eq("name",o.category_name).eq("user_id",a).maybeSingle();if(u){const E={};o.allocation_percent!==void 0&&(E.allocation_percent=o.allocation_percent),o.allocation_amount!==void 0&&(E.allocation_amount=o.allocation_amount),await N.from("categories").update(E).eq("id",u.id),D({title:"Настройки обновлены",description:`Настройки категории "${o.category_name}" обновлены`})}else D({title:"Категория не найдена",description:`Категория "${o.category_name}" не существует`,variant:"destructive"});break}case"create_income_source":await N.from("income_sources").insert({user_id:a,name:o.name,amount:o.amount,color:"#10b981"}),D({title:"Источник дохода создан",description:`Источник "${o.name}" успешно создан`});break;case"add_expense":{const{data:u}=await N.from("categories").select("id").eq("name",o.category_name).eq("user_id",a).single();u&&(await N.from("expenses").insert({user_id:s.id,category_id:u.id,amount:o.amount,description:o.description,date:o.date||new Date().toISOString()}),D({title:"Расход добавлен",description:`Расход ${o.amount} ₽ добавлен`}));break}case"add_income":{const{data:u}=await N.from("income_sources").select("id").eq("name",o.source_name).eq("user_id",a).single();u&&(await N.from("incomes").insert({user_id:s.id,source_id:u.id,amount:o.amount,description:o.description,date:o.date||new Date().toISOString()}),D({title:"Доход добавлен",description:`Доход ${o.amount} ₽ добавлен`}));break}case"update_category":{const{data:u}=await N.from("categories").select("id").eq("name",o.old_name).eq("user_id",a).maybeSingle();if(u){const E={};o.new_name&&(E.name=o.new_name),o.icon&&(E.icon=o.icon),await N.from("categories").update(E).eq("id",u.id),D({title:"Категория обновлена",description:`Категория "${o.old_name}" успешно обновлена`})}else D({title:"Категория не найдена",description:`Категория "${o.old_name}" не существует`,variant:"destructive"});break}case"delete_category":{const{data:u}=await N.from("categories").select("id").eq("name",o.name).eq("user_id",a).maybeSingle();u?(await N.from("categories").delete().eq("id",u.id),D({title:"Категория удалена",description:`Категория "${o.name}" успешно удалена`})):D({title:"Категория не найдена",description:`Категория "${o.name}" не существует`,variant:"destructive"});break}case"update_income_source":{const{data:u}=await N.from("income_sources").select("id").eq("name",o.old_name).eq("user_id",a).maybeSingle();if(u){const E={};o.new_name&&(E.name=o.new_name),o.amount!==void 0&&(E.amount=o.amount),await N.from("income_sources").update(E).eq("id",u.id),D({title:"Источник обновлен",description:`Источник "${o.old_name}" успешно обновлен`})}else D({title:"Источник не найден",description:`Источник "${o.old_name}" не существует`,variant:"destructive"});break}case"delete_income_source":{const{data:u}=await N.from("income_sources").select("id").eq("name",o.name).eq("user_id",a).maybeSingle();u?(await N.from("income_sources").delete().eq("id",u.id),D({title:"Источник удален",description:`Источник "${o.name}" успешно удален`})):D({title:"Источник не найден",description:`Источник "${o.name}" не существует`,variant:"destructive"});break}case"update_expense":{let u=N.from("expenses").select("id, category_id").eq("user_id",s.id);o.description&&(u=u.eq("description",o.description)),o.amount&&(u=u.eq("amount",o.amount)),o.date&&(u=u.gte("date",o.date).lt("date",o.date+"T23:59:59"));const{data:E}=await u.maybeSingle();if(E){const x={};if(o.new_amount!==void 0&&(x.amount=o.new_amount),o.new_description&&(x.description=o.new_description),o.new_category_name){const{data:j}=await N.from("categories").select("id").eq("name",o.new_category_name).eq("user_id",a).single();j&&(x.category_id=j.id)}await N.from("expenses").update(x).eq("id",E.id),D({title:"Расход обновлен",description:"Расход успешно обновлен"})}else D({title:"Расход не найден",description:"Расход с такими параметрами не найден",variant:"destructive"});break}case"delete_expense":{let u=N.from("expenses").select("id").eq("user_id",s.id);o.description&&(u=u.eq("description",o.description)),o.amount&&(u=u.eq("amount",o.amount)),o.date&&(u=u.gte("date",o.date).lt("date",o.date+"T23:59:59"));const{data:E}=await u.maybeSingle();E?(await N.from("expenses").delete().eq("id",E.id),D({title:"Расход удален",description:"Расход успешно удален"})):D({title:"Расход не найден",description:"Расход с такими параметрами не найден",variant:"destructive"});break}case"update_income":{let u=N.from("incomes").select("id, source_id").eq("user_id",s.id);o.description&&(u=u.eq("description",o.description)),o.amount&&(u=u.eq("amount",o.amount)),o.date&&(u=u.gte("date",o.date).lt("date",o.date+"T23:59:59"));const{data:E}=await u.maybeSingle();if(E){const x={};if(o.new_amount!==void 0&&(x.amount=o.new_amount),o.new_description&&(x.description=o.new_description),o.new_source_name){const{data:j}=await N.from("income_sources").select("id").eq("name",o.new_source_name).eq("user_id",a).single();j&&(x.source_id=j.id)}await N.from("incomes").update(x).eq("id",E.id),D({title:"Доход обновлен",description:"Доход успешно обновлен"})}else D({title:"Доход не найден",description:"Доход с такими параметрами не найден",variant:"destructive"});break}case"delete_income":{let u=N.from("incomes").select("id").eq("user_id",s.id);o.description&&(u=u.eq("description",o.description)),o.amount&&(u=u.eq("amount",o.amount)),o.date&&(u=u.gte("date",o.date).lt("date",o.date+"T23:59:59"));const{data:E}=await u.maybeSingle();E?(await N.from("incomes").delete().eq("id",E.id),D({title:"Доход удален",description:"Доход успешно удален"})):D({title:"Доход не найден",description:"Доход с такими параметрами не найден",variant:"destructive"});break}}}catch(u){console.error("Tool call error:",u),D({title:"Ошибка",description:"Не удалось выполнить действие",variant:"destructive"})}}},ne=async g=>{const v=g.target.files;if(!v||v.length===0)return;const _=[];for(const T of Array.from(v)){if(T.size>20*1024*1024){D({title:"Файл слишком большой",description:`${T.name} превышает 20MB`,variant:"destructive"});continue}const A=new FileReader;await new Promise(o=>{A.onload=()=>{const u=A.result;_.push({type:T.type.startsWith("image/")?"image":"document",url:u,name:T.name}),o(null)},A.readAsDataURL(T)})}y(T=>[...T,..._]),G.current&&(G.current.value="")},F=g=>{y(v=>v.filter((_,T)=>T!==g))},Y=async()=>{var _,T;if(!i.trim()&&f.length===0)return;const g=[];i.trim()&&g.push({type:"text",text:i.trim()}),f.forEach(A=>{A.type==="image"?g.push({type:"image_url",image_url:{url:A.url}}):g.push({type:"text",text:`[Документ: ${A.name}]`})});const v={role:"user",content:g.length===1&&typeof g[0]=="object"&&"text"in g[0]?g[0].text:g};d(A=>[...A,v]),h(""),y([]),b(!0);try{const A="https://sgchzovehcbezdinsnne.supabase.co/functions/v1/ai-chat",{data:{session:o}}=await N.auth.getSession();if(!o)throw new Error("Необходима авторизация");const u=await fetch(A,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.access_token}`,apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNnY2h6b3ZlaGNiZXpkaW5zbm5lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2NzY2NzMsImV4cCI6MjA3NTI1MjY3M30.xvmoHJwVxoY7cEZIFg3plgL_c7WRwVKC8Uwq6osbldY"},body:JSON.stringify({messages:[...n,v],userId:s==null?void 0:s.id})});if(!u.ok){const se=await u.json();throw new Error(se.error||"Ошибка при отправке запроса")}if(!u.body)throw new Error("Нет данных в ответе");const E=u.body.getReader(),x=new TextDecoder;let j="",L=!1,U="",te=[];for(;!L;){const{done:se,value:me}=await E.read();if(se)break;j+=x.decode(me,{stream:!0});let Z;for(;(Z=j.indexOf(`
`))!==-1;){let O=j.slice(0,Z);if(j=j.slice(Z+1),O.endsWith("\r")&&(O=O.slice(0,-1)),O.startsWith(":")||O.trim()===""||!O.startsWith("data: "))continue;const ce=O.slice(6).trim();if(ce==="[DONE]"){L=!0;break}try{const ae=(T=(_=JSON.parse(ce).choices)==null?void 0:_[0])==null?void 0:T.delta;ae!=null&&ae.content&&(U+=ae.content,d(oe=>{const de=[...oe],l=de[de.length-1];return(l==null?void 0:l.role)==="assistant"&&!l.tool_calls?de[de.length-1]={role:"assistant",content:U}:de.push({role:"assistant",content:U}),de})),ae!=null&&ae.tool_calls&&(te=[...te,...ae.tool_calls])}catch{j=O+`
`+j;break}}}if(te.length>0){await H(te);const se={role:"assistant",content:"Готово! Я выполнил все необходимые действия. ✅"};d(me=>[...me,se])}}catch(A){console.error("Chat error:",A),D({title:"Ошибка",description:A instanceof Error?A.message:"Не удалось получить ответ от AI",variant:"destructive"})}finally{b(!1),setTimeout(()=>{var A;(A=W.current)==null||A.focus()},500)}},J=g=>typeof g=="string"?g.split(`
`).map((v,_)=>{if(v.includes("**")){const T=v.split("**");return e.jsx("p",{className:"my-2",children:T.map((A,o)=>o%2===1?e.jsx("strong",{children:A},o):A)},_)}return v?e.jsx("p",{className:"my-1",children:v},_):e.jsx("br",{},_)}):g.map((v,_)=>{var T;return"text"in v?e.jsx("p",{className:"whitespace-pre-wrap",children:v.text},_):"image_url"in v?e.jsx("img",{src:(T=v.image_url)==null?void 0:T.url,alt:"Загруженное изображение",className:"max-w-full rounded-lg my-2"},_):null});return e.jsx(Ye,{open:t,onOpenChange:g=>{c(g),g||k(!1)},children:e.jsxs(Ue,{className:"w-[min(100vw-2rem,42rem)] sm:w-full sm:max-w-2xl h-[85vh] sm:h-[70vh] flex flex-col p-0",children:[e.jsx(Xe,{className:"px-4 pt-4 pb-2 border-b",children:e.jsx(Ge,{className:"text-lg font-medium",children:"G.A.I.A."})}),e.jsx(_t,{className:"flex-1 px-3 sm:px-4",ref:M,children:e.jsxs("div",{className:"space-y-2 sm:space-y-3 py-2 sm:py-3",children:[n.map((g,v)=>e.jsx("div",{className:Ne("flex gap-2 p-2 sm:p-3 rounded-lg",g.role==="user"?"bg-primary/10 ml-4 sm:ml-6":"bg-muted/30 mr-4 sm:mr-6"),children:e.jsx("div",{className:"flex-1 text-sm",children:J(g.content)})},v)),m&&e.jsxs("div",{className:"flex gap-2 p-2 sm:p-3 rounded-lg bg-muted mr-4 sm:mr-6",children:[e.jsx(Dt,{className:"h-4 w-4 animate-spin text-primary"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Думаю..."})]}),e.jsx("div",{ref:$})]})}),e.jsxs("div",{className:"px-3 sm:px-4 pb-3 sm:pb-4",children:[f.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:f.map((g,v)=>e.jsxs("div",{className:"flex items-center gap-1 bg-muted px-2 py-1 rounded text-xs",children:[e.jsx("span",{className:"max-w-[80px] sm:max-w-[100px] truncate",children:g.name}),e.jsx(P,{type:"button",variant:"ghost",size:"icon",className:"h-4 w-4",onClick:()=>F(v),children:e.jsx(Lt,{className:"h-3 w-3"})})]},v))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:G,type:"file",accept:"image/*,.pdf,.doc,.docx,.txt",multiple:!0,className:"hidden",onChange:ne}),e.jsx(P,{type:"button",variant:"ghost",size:"icon",onClick:()=>{var g;return(g=G.current)==null?void 0:g.click()},disabled:m,className:"h-9 w-9 sm:h-10 sm:w-10",children:e.jsx(as,{className:"h-4 w-4"})}),e.jsx($t,{ref:W,value:i,onChange:g=>h(g.target.value),onKeyDown:g=>{g.key==="Enter"&&!g.shiftKey&&(g.preventDefault(),Y())},placeholder:"Напишите сообщение...",className:"min-h-[36px] sm:min-h-[40px] resize-none text-sm",disabled:m}),e.jsx(P,{onClick:Y,disabled:m||!i.trim()&&f.length===0,size:"icon",className:"h-9 w-9 sm:h-10 sm:w-10",children:e.jsx(ns,{className:"h-4 w-4"})})]})]})]})})}const ye=[{icon:"🏠",name:"Жилье"},{icon:"🍕",name:"Питание"},{icon:"🚗",name:"Транспорт"},{icon:"🎮",name:"Развлечения"},{icon:"👕",name:"Одежда"},{icon:"💊",name:"Здоровье"}];function Ns({open:t,onOpenChange:c,onComplete:s,userId:a}){const[n,d]=r.useState(1),{toast:i}=mt(),[h,m]=r.useState(!1),[b,f]=r.useState(""),[y,w]=r.useState("monthly"),[k,M]=r.useState(""),[$,G]=r.useState(""),[W,ee]=r.useState(new Date().toISOString().split("T")[0]),[H,ne]=r.useState(new Set),[F,Y]=r.useState({}),J=6,g=n/J*100,v=async()=>{if(!b.trim()){i({title:"Заполните поле",description:"Укажите название источника дохода",variant:"destructive"});return}m(!0);try{const{data:x,error:j}=await N.from("income_sources").insert({user_id:a,name:b,frequency:y,color:"#10b981"}).select().single();if(j)throw j;M(x.id),i({title:"Источник создан!",description:`${b} успешно добавлен`}),d(3)}catch(x){i({title:"Ошибка",description:x.message,variant:"destructive"})}finally{m(!1)}},_=async()=>{if(!$){i({title:"Укажите сумму",description:"Введите сумму полученного дохода",variant:"destructive"});return}m(!0);try{const{error:x}=await N.from("incomes").insert({user_id:a,source_id:k,amount:Number($),date:W});if(x)throw x;i({title:"Доход добавлен!",description:`${$} добавлено к источнику`}),d(4)}catch(x){i({title:"Ошибка",description:x.message,variant:"destructive"})}finally{m(!1)}},T=x=>{const j=new Set(H);if(j.has(x)){j.delete(x);const L={...F};delete L[x],Y(L)}else j.add(x);ne(j)},A=(x,j,L)=>{Y({...F,[x]:{value:j,type:L}})},o=async()=>{if(H.size===0){i({title:"Выберите категории",description:"Выберите хотя бы одну категорию",variant:"destructive"});return}m(!0);try{const x=Array.from(H).map(U=>({user_id:a,name:ye[U].name,icon:ye[U].icon})),{data:j,error:L}=await N.from("categories").insert(x).select();if(L)throw L;i({title:"Категории созданы!",description:`Создано ${H.size} категорий`}),d(5)}catch(x){i({title:"Ошибка",description:x.message,variant:"destructive"})}finally{m(!1)}},u=async()=>{if(!(Object.keys(F).length>0)){i({title:"Укажите распределение",description:"Задайте сумму или процент хотя бы для одной категории",variant:"destructive"});return}m(!0);try{const{data:j,error:L}=await N.from("categories").select("id, name").eq("user_id",a).order("created_at",{ascending:!1}).limit(H.size);if(L)throw L;const U=Array.from(H).filter(se=>F[se]).map((se,me)=>{const Z=j[me],O=F[se];return{category_id:Z.id,income_source_id:k,allocation_type:O.type,allocation_value:Number(O.value)}}),{error:te}=await N.from("category_allocations").insert(U);if(te)throw te;i({title:"Связывание завершено!",description:"Категории успешно связаны с источником дохода"}),d(6)}catch(j){i({title:"Ошибка",description:j.message,variant:"destructive"})}finally{m(!1)}},E=()=>{s(),c(!1)};return e.jsx(Ye,{open:t,onOpenChange:c,children:e.jsxs(Ue,{className:"sm:max-w-[600px]",children:[e.jsxs(Xe,{children:[e.jsxs(Ge,{className:"flex items-center gap-2 text-xl",children:[e.jsx(os,{className:"h-5 w-5 text-primary"}),"Быстрый старт"]}),e.jsxs(ut,{children:["Шаг ",n," из ",J]})]}),e.jsx(Gt,{value:g,className:"mb-4"}),n===1&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Добро пожаловать в CrystalBudget! 💎"}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-3 text-sm",children:[e.jsx("p",{className:"text-muted-foreground",children:"CrystalBudget — это умный инструмент для управления личными финансами."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium",children:"Основной функционал:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-muted-foreground ml-2",children:[e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:"Источники дохода"})," — создавайте источники и фиксируйте поступления денег"]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:"Категории расходов"})," — группируйте траты и контролируйте бюджет"]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:"Распределение бюджета"})," — привязывайте категории к источникам и задавайте лимиты"]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:"Отслеживание баланса"})," — смотрите остатки и переносите их между месяцами"]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:"Аналитика"})," — графики и отчеты по вашим финансам"]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:"Telegram бот"})," — добавляйте транзакции и сканируйте чеки прямо из мессенджера 🤖"]})]})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(P,{variant:"outline",onClick:()=>c(!1),className:"flex-1",children:"Пропустить"}),e.jsx(P,{onClick:()=>d(2),className:"flex-1",children:"Начать настройку"})]})]}),n===2&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary mb-2",children:[e.jsx(Ee,{className:"h-5 w-5"}),e.jsx("h3",{className:"font-semibold",children:"Создайте первый источник дохода"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Источник дохода - это откуда вы получаете деньги (например, зарплата, фриланс, бизнес)"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(_e,{htmlFor:"source-name",children:"Название"}),e.jsx(ke,{id:"source-name",placeholder:"Например: Зарплата",value:b,onChange:x=>f(x.target.value)})]}),e.jsxs("div",{children:[e.jsx(_e,{htmlFor:"source-frequency",children:"Частота"}),e.jsxs(Te,{value:y,onValueChange:w,children:[e.jsx(Pe,{id:"source-frequency",children:e.jsx(Re,{})}),e.jsxs(De,{children:[e.jsx(re,{value:"monthly",children:"Ежемесячно"}),e.jsx(re,{value:"weekly",children:"Еженедельно"}),e.jsx(re,{value:"once",children:"Разово"})]})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(P,{variant:"outline",onClick:()=>d(1),className:"flex-1",children:"Назад"}),e.jsx(P,{onClick:v,disabled:h,className:"flex-1",children:"Далее"})]})]}),n===3&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary mb-2",children:[e.jsx(ve,{className:"h-5 w-5"}),e.jsx("h3",{className:"font-semibold",children:"Добавьте доход в источник"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:['Укажите сколько денег вы получили из источника "',b,'"']}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(_e,{htmlFor:"income-amount",children:"Сумма"}),e.jsx(ke,{id:"income-amount",inputMode:"decimal",placeholder:"50000",value:$,onChange:x=>it(x.target.value,G)})]}),e.jsxs("div",{children:[e.jsx(_e,{htmlFor:"income-date",children:"Дата"}),e.jsx(ke,{id:"income-date",type:"date",value:W,onChange:x=>ee(x.target.value)})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(P,{variant:"outline",onClick:()=>d(2),className:"flex-1",children:"Назад"}),e.jsx(P,{onClick:_,disabled:h,className:"flex-1",children:"Далее"})]})]}),n===4&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary mb-2",children:[e.jsx(ge,{className:"h-5 w-5"}),e.jsx("h3",{className:"font-semibold",children:"Выберите категории расходов"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Категории помогут вам отслеживать на что вы тратите деньги"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:ye.map((x,j)=>e.jsxs(P,{variant:H.has(j)?"default":"outline",className:"h-auto py-3 justify-start",onClick:()=>T(j),children:[e.jsx("span",{className:"text-2xl mr-2",children:x.icon}),e.jsx("span",{children:x.name})]},j))}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(P,{variant:"outline",onClick:()=>d(3),className:"flex-1",children:"Назад"}),e.jsx(P,{onClick:o,disabled:h,className:"flex-1",children:"Далее"})]})]}),n===5&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary mb-2",children:[e.jsx(ts,{className:"h-5 w-5"}),e.jsx("h3",{className:"font-semibold",children:"Распределите бюджет"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:['Укажите процент или фиксированную сумму для каждой категории из "',b,'"']}),e.jsx("div",{className:"space-y-3 max-h-[300px] overflow-y-auto",children:Array.from(H).map(x=>{const j=F[x],L=(j==null?void 0:j.type)||"percent";return e.jsxs("div",{className:"space-y-2 p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:ye[x].icon}),e.jsx("span",{className:"flex-1 font-medium",children:ye[x].name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Te,{value:L,onValueChange:U=>{A(x,(j==null?void 0:j.value)||"",U)},children:[e.jsx(Pe,{className:"w-28",children:e.jsx(Re,{})}),e.jsxs(De,{children:[e.jsx(re,{value:"percent",children:"Процент"}),e.jsx(re,{value:"amount",children:"Сумма"})]})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-1",children:[e.jsx(ke,{inputMode:"decimal",placeholder:L==="percent"?"10":"5000",value:(j==null?void 0:j.value)||"",onChange:U=>it(U.target.value,te=>A(x,te,L)),className:"text-right",min:"0",max:L==="percent"?"100":void 0}),e.jsx("span",{className:"text-muted-foreground w-8",children:L==="percent"?"%":"₽"})]})]})]},x)})}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(P,{variant:"outline",onClick:()=>d(4),className:"flex-1",children:"Назад"}),e.jsx(P,{onClick:u,disabled:h,className:"flex-1",children:"Далее"})]})]}),n===6&&e.jsxs("div",{className:"space-y-4 text-center py-6",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(es,{className:"h-16 w-16 text-success"})}),e.jsx("h3",{className:"text-2xl font-bold",children:"Готово!"}),e.jsx("p",{className:"text-muted-foreground",children:"Вы успешно создали свой первый источник дохода и категории расходов. Теперь вы можете начать отслеживать свой бюджет!"}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 mt-4 space-y-2 text-sm text-left",children:[e.jsx("p",{className:"font-semibold",children:"Что дальше?"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-muted-foreground",children:[e.jsx("li",{children:"Добавляйте доходы и расходы через кнопки на главной странице"}),e.jsx("li",{children:"Создавайте дополнительные источники дохода и категории"}),e.jsx("li",{children:"Подключите Telegram бот для быстрого добавления транзакций 🤖"}),e.jsx("li",{children:"Отслеживайте свой баланс и статистику"})]})]}),e.jsx(P,{onClick:E,className:"w-full mt-6",children:"Начать пользоваться"})]})]})})}function Ss({open:t,onOpenChange:c,onConnectNow:s}){const a=()=>{localStorage.setItem("telegram_guide_shown","true"),c(!1)},n=()=>{localStorage.setItem("telegram_guide_shown","true"),s(),c(!1)};return e.jsx(Ye,{open:t,onOpenChange:c,children:e.jsxs(Ue,{className:"sm:max-w-[500px]",children:[e.jsxs(Xe,{children:[e.jsxs(Ge,{className:"flex items-center gap-2 text-xl",children:[e.jsx(Fe,{className:"h-6 w-6 text-primary"}),"Telegram бот для CrystalBudget"]}),e.jsx(ut,{children:"Управляйте финансами ещё проще и быстрее!"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary/10 to-primary/5 rounded-lg p-6 text-center space-y-3",children:[e.jsx(Fe,{className:"h-12 w-12 text-primary mx-auto"}),e.jsx("p",{className:"text-lg font-semibold",children:"У нас есть Telegram бот! 🎉"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Добавляйте транзакции прямо из мессенджера за пару секунд"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"font-medium text-sm",children:"Что умеет бот:"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3 items-start",children:[e.jsx("div",{className:"h-9 w-9 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(is,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:"Быстрое добавление"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Добавляйте доходы и расходы через удобные кнопки в Telegram"})]})]}),e.jsxs("div",{className:"flex gap-3 items-start",children:[e.jsx("div",{className:"h-9 w-9 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(Qt,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:"Сканирование чеков"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Просто сфотографируйте чек - AI автоматически распознает сумму и категорию"})]})]}),e.jsxs("div",{className:"flex gap-3 items-start",children:[e.jsx("div",{className:"h-9 w-9 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(ss,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:"Проверка баланса"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Узнавайте текущий баланс, доходы и расходы не открывая приложение"})]})]})]})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3 text-xs text-muted-foreground",children:[e.jsx(Vt,{className:"h-3 w-3 inline mr-1"}),"Вы всегда можете настроить Telegram бот позже в разделе ",e.jsx("span",{className:"font-medium",children:"Настройки"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(P,{variant:"outline",onClick:a,className:"flex-1",children:"Может позже"}),e.jsx(P,{onClick:n,className:"flex-1",children:"Подключить сейчас"})]})]})]})})}function Cs(){return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:[1,2,3].map(t=>e.jsxs(Ae,{className:"p-4 sm:p-6",children:[e.jsx(V,{className:"h-4 w-32 mb-2"}),e.jsx(V,{className:"h-8 w-24 mb-2"}),e.jsx(V,{className:"h-3 w-40"})]},t))}),e.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[e.jsx(V,{className:"flex-1 h-12"}),e.jsx(V,{className:"flex-1 h-12"}),e.jsx(V,{className:"h-12 w-20"})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsx(V,{className:"h-10 w-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"h-6 w-48 mb-3"}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-2 sm:gap-2.5",children:[1,2].map(t=>e.jsxs(Ae,{className:"p-4",children:[e.jsx(V,{className:"h-5 w-32 mb-3"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"h-4 w-full"}),e.jsx(V,{className:"h-4 w-3/4"}),e.jsx(V,{className:"h-2 w-full mt-2"})]})]},t))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(V,{className:"h-6 w-48"}),e.jsx(V,{className:"h-8 w-32"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2 sm:gap-3",children:[1,2,3,4,5,6].map(t=>e.jsxs(Ae,{className:"p-3",children:[e.jsx(V,{className:"h-5 w-full mb-3"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"h-3 w-full"}),e.jsx(V,{className:"h-2 w-full"}),e.jsx(V,{className:"h-3 w-2/3"})]})]},t))})]})]})]})}function He({icon:t,title:c,description:s,action:a}){const n=a==null?void 0:a.icon;return e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4 text-center",children:[e.jsx("div",{className:"rounded-full bg-muted/50 p-6 mb-4 animate-in fade-in zoom-in duration-300",children:e.jsx(t,{className:"h-12 w-12 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2 animate-in fade-in slide-in-from-bottom-2 duration-300 delay-100",children:c}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6 max-w-sm animate-in fade-in slide-in-from-bottom-2 duration-300 delay-200",children:s}),a&&e.jsxs(P,{onClick:a.onClick,size:"lg",className:"animate-in fade-in slide-in-from-bottom-2 duration-300 delay-300",children:[n&&e.jsx(n,{className:"h-4 w-4 mr-2"}),a.label]})]})}const Hs=()=>{const[t,c]=r.useState(new Date),s=Mt(),{user:a}=$e(),{toast:n}=mt(),{formatAmount:d}=Jt(),[i,h]=r.useState([]),[m,b]=r.useState([]),[f,y]=r.useState([]),[w,k]=r.useState([]),[M,$]=r.useState(!0),[G,W]=r.useState(!1),[ee,H]=r.useState(!1),[ne,F]=r.useState(!1),[Y,J]=r.useState(!1),[g,v]=r.useState(!1),[_,T]=r.useState(0),[A,o]=r.useState("name"),[u,E]=r.useState(()=>{const l=localStorage.getItem("dashboard_compact_view");return l?JSON.parse(l):!1}),[x,j]=r.useState("all");r.useEffect(()=>{a&&L()},[a,t]),r.useEffect(()=>{localStorage.setItem("dashboard_compact_view",JSON.stringify(u))},[u]),r.useEffect(()=>{a&&!M&&i.length===0&&m.length===0&&J(!0)},[a,M,i.length,m.length]),r.useEffect(()=>{if(a&&!M&&!Y&&!localStorage.getItem("telegram_guide_shown")){const p=setTimeout(()=>{v(!0)},500);return()=>clearTimeout(p)}},[a,M,Y]);const L=async()=>{try{const l=new Date(t.getFullYear(),t.getMonth(),1).toISOString(),p=new Date(t.getFullYear(),t.getMonth()+1,0,23,59,59).toISOString(),{data:S}=await N.from("incomes").select("amount").lt("date",l),{data:I}=await N.from("expenses").select("amount").lt("date",l),C=(S||[]).reduce((q,be)=>q+Number(be.amount),0),z=(I||[]).reduce((q,be)=>q+Number(be.amount),0),fe=C-z;T(fe);const{data:ie,error:K}=await N.from("income_sources").select("*").order("created_at",{ascending:!1});if(K)throw K;const R=(ie||[]).map(q=>({id:q.id,name:q.name,color:q.color,amount:q.amount?Number(q.amount):void 0,frequency:q.frequency||void 0,receivedDate:q.received_date||void 0}));h(R);const{data:B,error:xe}=await N.from("categories").select("*").order("created_at",{ascending:!1});if(xe)throw xe;const{data:It,error:et}=await N.from("category_allocations").select("*");if(et)throw et;const At=(B||[]).map(q=>{const be=(It||[]).filter(pe=>pe.category_id===q.id).map(pe=>({id:pe.id,incomeSourceId:pe.income_source_id,allocationType:pe.allocation_type,allocationValue:Number(pe.allocation_value)}));return{id:q.id,name:q.name,icon:q.icon,allocations:be,linkedSourceId:q.linked_source_id||void 0,allocationAmount:q.allocation_amount?Number(q.allocation_amount):void 0,allocationPercent:q.allocation_percent?Number(q.allocation_percent):void 0}});b(At);const{data:Et,error:tt}=await N.from("incomes").select("*").gte("date",l).lte("date",p);if(tt)throw tt;y(Et||[]);const{data:Tt,error:st}=await N.from("expenses").select("*").gte("date",l).lte("date",p);if(st)throw st;k(Tt||[])}catch(l){n({title:"Ошибка загрузки",description:l.message,variant:"destructive"})}finally{$(!1)}},U=r.useCallback(async l=>{if(!a)return;const p={id:`temp-${Date.now()}`,user_id:a.id,source_id:l.sourceId,amount:l.amount,date:l.date,description:l.description,created_at:new Date().toISOString()};y(S=>[...S,p]);try{const{data:S,error:I}=await N.from("incomes").insert({user_id:a.id,source_id:l.sourceId,amount:l.amount,date:l.date,description:l.description}).select().single();if(I)throw I;y(C=>C.map(z=>z.id===p.id?S:z)),n({title:"Доход добавлен",description:"Транзакция успешно записана"})}catch(S){y(I=>I.filter(C=>C.id!==p.id)),n({title:"Ошибка",description:S.message,variant:"destructive"})}},[a,n]),te=r.useCallback(async l=>{if(!a)return;const p={id:`temp-${Date.now()}`,user_id:a.id,category_id:l.categoryId,amount:l.amount,date:l.date,description:l.description,created_at:new Date().toISOString()};k(S=>[...S,p]);try{const{data:S,error:I}=await N.from("expenses").insert({user_id:a.id,category_id:l.categoryId,amount:l.amount,date:l.date,description:l.description}).select().single();if(I)throw I;k(C=>C.map(z=>z.id===p.id?S:z)),n({title:"Расход добавлен",description:"Транзакция успешно записана"})}catch(S){k(I=>I.filter(C=>C.id!==p.id)),n({title:"Ошибка",description:S.message,variant:"destructive"})}},[a,n]),se=()=>i.map(l=>{const S=f.filter(R=>R.source_id===l.id).reduce((R,B)=>R+Number(B.amount),0),I=S>0?S:l.amount||0;let C=0;m.forEach(R=>{R.allocations&&R.allocations.length>0?R.allocations.forEach(B=>{B.incomeSourceId===l.id&&(B.allocationType==="amount"?C+=B.allocationValue:B.allocationType==="percent"&&(C+=I*B.allocationValue/100))}):R.linkedSourceId===l.id&&(R.allocationAmount?C+=R.allocationAmount:R.allocationPercent&&(C+=I*R.allocationPercent/100))});const z=[];m.forEach(R=>{R.allocations&&R.allocations.length>0?R.allocations.some(xe=>xe.incomeSourceId===l.id)&&z.push(R.id):R.linkedSourceId===l.id&&z.push(R.id)});const fe=w.filter(R=>z.includes(R.category_id)).reduce((R,B)=>R+Number(B.amount),0),ie=I-C,K=ie<0?Math.abs(ie):0;return{sourceId:l.id,totalIncome:I,totalSpent:fe,remaining:ie>0?ie:0,debt:K}}),me=()=>m.map(l=>{var I;let p=0;if(l.allocations&&l.allocations.length>0)l.allocations.forEach(C=>{var z;if(C.allocationType==="amount")p+=C.allocationValue;else if(C.allocationType==="percent"){const ie=f.filter(B=>B.source_id===C.incomeSourceId).reduce((B,xe)=>B+Number(xe.amount),0),K=((z=i.find(B=>B.id===C.incomeSourceId))==null?void 0:z.amount)||0,R=ie>0?ie:K;p+=R*C.allocationValue/100}});else if(l.allocationAmount)p=l.allocationAmount;else if(l.linkedSourceId&&l.allocationPercent){const z=f.filter(K=>K.source_id===l.linkedSourceId).reduce((K,R)=>K+Number(R.amount),0),fe=((I=i.find(K=>K.id===l.linkedSourceId))==null?void 0:I.amount)||0;p=(z>0?z:fe)*l.allocationPercent/100}const S=w.filter(C=>C.category_id===l.id).reduce((C,z)=>C+Number(z.amount),0);return{categoryId:l.id,allocated:p,spent:S,remaining:p-S}}),Z=r.useMemo(()=>f.reduce((l,p)=>l+Number(p.amount),0),[f]),O=r.useMemo(()=>w.reduce((l,p)=>l+Number(p.amount),0),[w]),ce=r.useMemo(()=>Z-O,[Z,O]),Ce=r.useMemo(()=>Z+_-O,[Z,_,O]),ae=r.useMemo(()=>se(),[i,f,w,m]),oe=r.useMemo(()=>me(),[m,f,w,i]),de=r.useMemo(()=>Wt(t,"LLLL",{locale:Kt}),[t]);return M?e.jsx(at,{selectedDate:t,onDateChange:c,children:e.jsx(Cs,{})}):e.jsxs(at,{selectedDate:t,onDateChange:c,children:[e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:[e.jsx(We,{title:`Баланс за ${de}`,value:d(ce),subtitle:ce>0?"Профицит":ce<0?"Дефицит":"Ноль",icon:Ht,variant:ce>0?"success":ce<0?"destructive":"default"}),e.jsx(We,{title:"Общие расходы",value:d(O),subtitle:Z>0?`${(O/Z*100).toFixed(0)}% от дохода`:void 0,icon:Zt,variant:"destructive"}),e.jsx(We,{title:"Общий баланс",value:d(Ce),subtitle:_!==0?`${d(ce)} + ${d(_)} остаток`:`Только за ${de}`,icon:rs,variant:Ce>0?"success":Ce<0?"destructive":"default"})]}),e.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[e.jsxs(P,{className:"flex-1 h-auto py-2.5 sm:py-3 text-sm bg-gradient-to-r from-success to-success/80 hover:from-success/90 hover:to-success/70 text-success-foreground border-0 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02]",onClick:()=>W(!0),children:[e.jsx(ve,{className:"h-5 w-5 mr-1 sm:mr-2 transition-transform duration-300 hover:rotate-90",strokeWidth:2.5}),e.jsx("span",{className:"hidden xs:inline",children:"Добавить "}),"Доход"]}),e.jsxs(P,{className:"flex-1 h-auto py-2.5 sm:py-3 text-sm bg-gradient-to-r from-destructive to-destructive/80 hover:from-destructive/90 hover:to-destructive/70 text-destructive-foreground border-0 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02]",onClick:()=>H(!0),children:[e.jsx(ve,{className:"h-5 w-5 mr-1 sm:mr-2 transition-transform duration-300 hover:rotate-90",strokeWidth:2.5}),e.jsx("span",{className:"hidden xs:inline",children:"Добавить "}),"Расход"]}),e.jsxs(P,{className:"h-auto py-2.5 sm:py-3 text-sm px-3 sm:px-4 flex items-center gap-2",variant:"secondary",onClick:()=>F(!0),children:[e.jsx(Fe,{className:"h-5 w-5"}),e.jsx("span",{className:"hidden sm:inline font-medium",children:"G.A.I.A."})]})]}),e.jsxs(zt,{defaultValue:"overview",className:"space-y-3 sm:space-y-4",children:[e.jsxs(Ot,{className:"grid w-full grid-cols-3 h-auto",children:[e.jsxs(Be,{value:"overview",className:"gap-1 sm:gap-2 py-2 text-xs sm:text-sm",children:[e.jsx(Ft,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{children:"Обзор"})]}),e.jsxs(Be,{value:"sources",className:"gap-1 sm:gap-2 py-2 text-xs sm:text-sm",children:[e.jsx(Ee,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{children:"Источники"})]}),e.jsxs(Be,{value:"categories",className:"gap-1 sm:gap-2 py-2 text-xs sm:text-sm",children:[e.jsx(ge,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{children:"Категории"})]})]}),e.jsxs(Ve,{value:"overview",className:"space-y-4 sm:space-y-6",children:[e.jsxs("section",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h2",{className:"text-sm sm:text-base font-bold flex items-center gap-1.5",children:[e.jsx(Ee,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 text-primary"}),e.jsx("span",{children:"Источники дохода"})]})}),i.length>0?e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-2 sm:gap-2.5",children:i.map(l=>{const p=ae.find(S=>S.sourceId===l.id);return p?e.jsx(rt,{source:l,summary:p},l.id):null})}):e.jsx(He,{icon:Ee,title:"Нет источников дохода",description:"Добавьте источник дохода, чтобы начать отслеживать финансы",action:{label:"Добавить источник",onClick:()=>s("/incomes"),icon:ve}})]}),e.jsxs("section",{className:"space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2",children:[e.jsxs("h2",{className:"text-base sm:text-lg font-bold flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"}),e.jsx("span",{children:"Категории расходов"}),e.jsxs("span",{className:"text-xs sm:text-sm text-muted-foreground font-normal",children:["(",m.length,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-muted rounded-lg p-1",children:[e.jsx(P,{variant:x==="all"?"default":"ghost",size:"sm",className:"h-7 text-xs px-2",onClick:()=>j("all"),children:"Все"}),e.jsx(P,{variant:x==="attention"?"default":"ghost",size:"sm",className:"h-7 text-xs px-2",onClick:()=>j("attention"),children:"Внимание"}),e.jsx(P,{variant:x==="exceeded"?"default":"ghost",size:"sm",className:"h-7 text-xs px-2",onClick:()=>j("exceeded"),children:"Превышены"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-muted rounded-lg p-1",children:[e.jsx(P,{variant:u?"ghost":"default",size:"sm",className:"h-7 w-7 p-0",onClick:()=>E(!1),title:"Детальный вид",children:e.jsx(lt,{className:"h-4 w-4"})}),e.jsx(P,{variant:u?"default":"ghost",size:"sm",className:"h-7 w-7 p-0",onClick:()=>E(!0),title:"Компактный вид",children:e.jsx(ct,{className:"h-4 w-4"})})]}),e.jsxs(Te,{value:A,onValueChange:l=>o(l),children:[e.jsxs(Pe,{className:"w-[120px] sm:w-[140px] h-8 text-xs",children:[e.jsx(ot,{className:"h-3 w-3 mr-1"}),e.jsx(Re,{})]}),e.jsxs(De,{children:[e.jsx(re,{value:"name",children:"Имя"}),e.jsx(re,{value:"spent",children:"Траты"}),e.jsx(re,{value:"remaining",children:"Остаток"})]})]})]})]}),m.length>0?e.jsx("div",{className:Ne("grid gap-2 sm:gap-3",u?"grid-cols-1":"grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"),children:[...m].filter(l=>{const p=oe.find(C=>C.categoryId===l.id);if(!p)return!1;const S=p.allocated>0?p.spent/p.allocated*100:0,I=p.spent>p.allocated;switch(x){case"attention":return S>70&&!I;case"exceeded":return I;default:return!0}}).sort((l,p)=>{const S=oe.find(C=>C.categoryId===l.id),I=oe.find(C=>C.categoryId===p.id);if(!S||!I)return 0;switch(A){case"name":return l.name.localeCompare(p.name);case"spent":return I.spent-S.spent;case"remaining":return I.remaining-S.remaining;default:return 0}}).map(l=>{const p=oe.find(S=>S.categoryId===l.id);return p?e.jsx(nt,{category:l,budget:p,incomeSources:i,showSources:!1,compact:u},l.id):null})}):e.jsx(He,{icon:ge,title:"Нет категорий расходов",description:"Создайте категории, чтобы организовать свои расходы",action:{label:"Создать категорию",onClick:()=>s("/categories"),icon:ve}})]})]}),e.jsxs(Ve,{value:"sources",className:"space-y-3 sm:space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between"}),i.length>0?e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4",children:i.map(l=>{const p=ae.find(S=>S.sourceId===l.id);return p?e.jsx(rt,{source:l,summary:p},l.id):null})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Нет источников дохода"})]}),e.jsxs(Ve,{value:"categories",className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2",children:[e.jsxs("h2",{className:"text-base sm:text-lg font-bold flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"}),e.jsx("span",{children:"Категории расходов"}),e.jsxs("span",{className:"text-xs sm:text-sm text-muted-foreground font-normal",children:["(",m.length,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-muted rounded-lg p-1",children:[e.jsx(P,{variant:x==="all"?"default":"ghost",size:"sm",className:"h-7 text-xs px-2",onClick:()=>j("all"),children:"Все"}),e.jsx(P,{variant:x==="attention"?"default":"ghost",size:"sm",className:"h-7 text-xs px-2",onClick:()=>j("attention"),children:"Внимание"}),e.jsx(P,{variant:x==="exceeded"?"default":"ghost",size:"sm",className:"h-7 text-xs px-2",onClick:()=>j("exceeded"),children:"Превышены"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-muted rounded-lg p-1",children:[e.jsx(P,{variant:u?"ghost":"default",size:"sm",className:"h-7 w-7 p-0",onClick:()=>E(!1),title:"Детальный вид",children:e.jsx(lt,{className:"h-4 w-4"})}),e.jsx(P,{variant:u?"default":"ghost",size:"sm",className:"h-7 w-7 p-0",onClick:()=>E(!0),title:"Компактный вид",children:e.jsx(ct,{className:"h-4 w-4"})})]}),e.jsxs(Te,{value:A,onValueChange:l=>o(l),children:[e.jsxs(Pe,{className:"w-[120px] sm:w-[140px] h-8 text-xs",children:[e.jsx(ot,{className:"h-3 w-3 mr-1"}),e.jsx(Re,{})]}),e.jsxs(De,{children:[e.jsx(re,{value:"name",children:"Имя"}),e.jsx(re,{value:"spent",children:"Траты"}),e.jsx(re,{value:"remaining",children:"Остаток"})]})]})]})]}),m.length>0?e.jsx("div",{className:Ne("grid gap-2 sm:gap-3",u?"grid-cols-1":"grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"),children:[...m].filter(l=>{const p=oe.find(C=>C.categoryId===l.id);if(!p)return!1;const S=p.allocated>0?p.spent/p.allocated*100:0,I=p.spent>p.allocated;switch(x){case"attention":return S>70&&!I;case"exceeded":return I;default:return!0}}).sort((l,p)=>{const S=oe.find(C=>C.categoryId===l.id),I=oe.find(C=>C.categoryId===p.id);if(!S||!I)return 0;switch(A){case"name":return l.name.localeCompare(p.name);case"spent":return I.spent-S.spent;case"remaining":return I.remaining-S.remaining;default:return 0}}).map(l=>{const p=oe.find(S=>S.categoryId===l.id);return p?e.jsx(nt,{category:l,budget:p,incomeSources:i,showSources:!0,compact:u},l.id):null})}):e.jsx(He,{icon:ge,title:"Нет категорий расходов",description:"Создайте категории для отслеживания расходов",action:{label:"Добавить категорию",onClick:()=>s("/categories"),icon:ve}})]})]})]}),e.jsx(Yt,{open:G,onOpenChange:W,incomeSources:i,onSave:U,onSourceCreated:L}),e.jsx(Ut,{open:ee,onOpenChange:H,categories:m,onSave:te}),e.jsx(ys,{open:ne,onOpenChange:F}),a&&e.jsxs(e.Fragment,{children:[e.jsx(Ns,{open:Y,onOpenChange:J,onComplete:()=>L(),userId:a.id}),e.jsx(Ss,{open:g,onOpenChange:v,onConnectNow:()=>s("/settings")})]})]})};export{Hs as default};
