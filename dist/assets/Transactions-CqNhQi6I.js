import{c as k,r as a,i as ne,s as i,j as e}from"./index-BczRz4ky.js";import{L as le,f as oe}from"./Layout-Cjs2lFUa.js";import{B as j,C as U,a as q}from"./crystal-icon-BR5-Rl_Z.js";import{u as de}from"./useCurrency-Ji0yYFK2.js";import{A as ce,I as me,E as ue}from"./ExpenseDialog-C6ziA7t1.js";import{S as I,a as T,b as _,d as A,e as o,T as xe}from"./select-DrkzBdXl.js";import{A as he,a as pe,b as fe,c as ge,d as je,e as ve,f as we,g as ye}from"./alert-dialog-B9w34hCo.js";import{P as z}from"./dialog-BsWlHXv2.js";import{r as Ne}from"./ru-DGv6tEtD.js";import"./label-03Zcm6W0.js";import"./IncomeSourceDialog-BpGFH5Ja.js";import"./types-Cqx1EfL_.js";import"./numberInput-Di0gcIKz.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=k("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=k("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=k("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),Be=()=>{const[x,B]=a.useState(new Date),{toast:n}=ne(),{formatAmount:E}=de(),[V,H]=a.useState([]),[v,L]=a.useState([]),[w,$]=a.useState([]),[Y,y]=a.useState(!1),[G,N]=a.useState(!1),[S,p]=a.useState(null),[b,f]=a.useState(null),[M,J]=a.useState("date"),[Ce,K]=a.useState({}),[d,D]=a.useState(null),[g,O]=a.useState("all"),[h,Q]=a.useState("all");a.useEffect(()=>{c()},[x]),a.useEffect(()=>{O("all")},[h]);const c=async()=>{const{data:{user:s}}=await i.auth.getUser();if(!s)return;const r=new Date(x.getFullYear(),x.getMonth(),1).toISOString(),l=new Date(x.getFullYear(),x.getMonth()+1,0,23,59,59).toISOString(),[se,te,F,P,ae]=await Promise.all([i.from("incomes").select("*").gte("date",r).lte("date",l).order("date",{ascending:!1}),i.from("expenses").select("*").gte("date",r).lte("date",l).order("date",{ascending:!1}),i.from("income_sources").select("*"),i.from("categories").select("*"),i.from("profiles").select("user_id, full_name")]);L(F.data||[]),$(P.data||[]);const m={};(ae.data||[]).forEach(t=>{t.user_id===s.id?m[t.user_id]=t.full_name||"–í—ã":m[t.user_id]=t.full_name||"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"}),m[s.id]||(m[s.id]="–í—ã"),K(m);const re=(se.data||[]).map(t=>{const u=(F.data||[]).find(C=>C.id===t.source_id);return{id:t.id,type:"income",amount:Number(t.amount),category:(u==null?void 0:u.name)||"–î–æ—Ö–æ–¥",date:t.date,description:t.description,sourceId:t.source_id,userName:m[t.user_id]||"–í—ã"}}),ie=(te.data||[]).map(t=>{const u=(P.data||[]).find(C=>C.id===t.category_id);return{id:t.id,type:"expense",amount:Number(t.amount),category:(u==null?void 0:u.name)||"–†–∞—Å—Ö–æ–¥",date:t.date,description:t.description,categoryId:t.category_id,userName:m[t.user_id]||"–í—ã"}});H([...re,...ie])},W=async s=>{const{data:{user:r}}=await i.auth.getUser();if(r)if(S){const{error:l}=await i.from("incomes").update({source_id:s.sourceId,amount:s.amount,date:s.date,description:s.description}).eq("id",S.id);l?n({title:"–û—à–∏–±–∫–∞",description:"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –¥–æ—Ö–æ–¥",variant:"destructive"}):(n({title:"–£—Å–ø–µ—à–Ω–æ",description:"–î–æ—Ö–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω"}),c()),p(null)}else{const{error:l}=await i.from("incomes").insert({user_id:r.id,source_id:s.sourceId,amount:s.amount,date:s.date,description:s.description});l?n({title:"–û—à–∏–±–∫–∞",description:"–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –¥–æ—Ö–æ–¥",variant:"destructive"}):(n({title:"–£—Å–ø–µ—à–Ω–æ",description:"–î–æ—Ö–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω"}),c())}},X=async s=>{const{data:{user:r}}=await i.auth.getUser();if(r)if(b){const{error:l}=await i.from("expenses").update({category_id:s.categoryId,amount:s.amount,date:s.date,description:s.description}).eq("id",b.id);l?n({title:"–û—à–∏–±–∫–∞",description:"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥",variant:"destructive"}):(n({title:"–£—Å–ø–µ—à–Ω–æ",description:"–†–∞—Å—Ö–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω"}),c()),f(null)}else{const{error:l}=await i.from("expenses").insert({user_id:r.id,category_id:s.categoryId,amount:s.amount,date:s.date,description:s.description});l?n({title:"–û—à–∏–±–∫–∞",description:"–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥",variant:"destructive"}):(n({title:"–£—Å–ø–µ—à–Ω–æ",description:"–†–∞—Å—Ö–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω"}),c())}},Z=s=>{s.type==="income"?(p({id:s.id,sourceId:s.sourceId||"",amount:s.amount,date:s.date,description:s.description}),y(!0)):(f({id:s.id,categoryId:s.categoryId||"",amount:s.amount,date:s.date,description:s.description}),N(!0))},ee=async()=>{if(!d)return;const s=d.type==="income"?"incomes":"expenses",{error:r}=await i.from(s).delete().eq("id",d.id);r?n({title:"–û—à–∏–±–∫–∞",description:"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é",variant:"destructive"}):(n({title:"–£—Å–ø–µ—à–Ω–æ",description:`${d.type==="income"?"–î–æ—Ö–æ–¥":"–†–∞—Å—Ö–æ–¥"} —É–¥–∞–ª—ë–Ω`}),c()),D(null)},R=[...V.filter(s=>!(h!=="all"&&s.type!==h||g!=="all"&&(s.type==="expense"&&s.categoryId!==g||s.type==="income"&&s.sourceId!==g)))].sort((s,r)=>M==="date"?new Date(r.date).getTime()-new Date(s.date).getTime():r.amount-s.amount);return e.jsxs(le,{selectedDate:x,onDateChange:B,children:[e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold",children:"–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"–ò—Å—Ç–æ—Ä–∏—è –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(j,{className:"flex-1 sm:flex-none bg-gradient-to-r from-success to-success/80 hover:from-success/90 hover:to-success/70 text-white border-0 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02]",onClick:()=>{p(null),y(!0)},children:[e.jsx(z,{className:"h-4 w-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden xs:inline",children:"–î–æ–±–∞–≤–∏—Ç—å "}),"–î–æ—Ö–æ–¥"]}),e.jsxs(j,{className:"flex-1 sm:flex-none bg-gradient-to-r from-destructive to-destructive/80 hover:from-destructive/90 hover:to-destructive/70 text-destructive-foreground border-0 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02]",onClick:()=>{f(null),N(!0)},children:[e.jsx(z,{className:"h-4 w-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden xs:inline",children:"–î–æ–±–∞–≤–∏—Ç—å "}),"–†–∞—Å—Ö–æ–¥"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(I,{value:h,onValueChange:s=>Q(s),children:[e.jsx(T,{className:"w-full sm:w-[180px]",children:e.jsx(_,{placeholder:"–¢–∏–ø"})}),e.jsxs(A,{children:[e.jsx(o,{value:"all",children:"–í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"}),e.jsx(o,{value:"income",children:"–î–æ—Ö–æ–¥—ã"}),e.jsx(o,{value:"expense",children:"–†–∞—Å—Ö–æ–¥—ã"})]})]}),e.jsxs(I,{value:g,onValueChange:O,children:[e.jsx(T,{className:"w-full sm:w-[220px]",children:e.jsx(_,{placeholder:"–ö–∞—Ç–µ–≥–æ—Ä–∏—è/–ò—Å—Ç–æ—á–Ω–∏–∫"})}),e.jsxs(A,{children:[e.jsx(o,{value:"all",children:"–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"}),h!=="income"&&w.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(o,{value:"expenses-header",disabled:!0,className:"font-semibold",children:"–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤"}),w.map(s=>e.jsxs(o,{value:s.id,children:[s.icon," ",s.name]},s.id))]}),h!=="expense"&&v.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(o,{value:"incomes-header",disabled:!0,className:"font-semibold",children:"–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–æ—Ö–æ–¥–∞"}),v.map(s=>e.jsxs(o,{value:s.id,children:["üí∞ ",s.name]},s.id))]})]})]}),e.jsxs(I,{value:M,onValueChange:s=>J(s),children:[e.jsxs(T,{className:"w-full sm:w-[180px]",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),e.jsx(_,{})]}),e.jsxs(A,{children:[e.jsx(o,{value:"date",children:"–ü–æ –¥–∞—Ç–µ"}),e.jsx(o,{value:"amount",children:"–ü–æ —Å—É–º–º–µ"})]})]})]}),e.jsx("div",{className:"space-y-2 sm:space-y-3",children:R.length===0?e.jsx(U,{children:e.jsx(q,{className:"p-6 sm:p-8 text-center",children:e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"–ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥"})})}):R.map(s=>e.jsx(U,{className:"hover:shadow-md transition-shadow",children:e.jsx(q,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start sm:items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg shrink-0 ${s.type==="income"?"bg-success/10":"bg-destructive/10"}`,children:s.type==="income"?e.jsx(be,{className:"h-4 w-4 sm:h-5 sm:w-5 text-success"}):e.jsx(Se,{className:"h-4 w-4 sm:h-5 sm:w-5 text-destructive"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-semibold text-sm sm:text-base truncate",children:s.category}),e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 sm:gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:s.description||"–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"‚Ä¢"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.userName}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"‚Ä¢"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:oe(new Date(s.date),"d MMM yyyy",{locale:Ne})})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between sm:justify-end gap-2 sm:gap-4",children:[e.jsxs("p",{className:`text-lg sm:text-xl font-bold ${s.type==="income"?"text-success":"text-destructive"}`,children:[s.type==="income"?"+":"-",E(s.amount)]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(j,{variant:"ghost",size:"icon",className:"shrink-0",onClick:()=>Z(s),children:e.jsx(De,{className:"h-4 w-4"})}),e.jsx(j,{variant:"ghost",size:"icon",className:"shrink-0 text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>D(s),children:e.jsx(xe,{className:"h-4 w-4"})})]})]})]})})},s.id))})]}),e.jsx(me,{open:Y,onOpenChange:s=>{y(s),s||p(null)},incomeSources:v,onSave:W,editingIncome:S,onSourceCreated:c}),e.jsx(ue,{open:G,onOpenChange:s=>{N(s),s||f(null)},categories:w,onSave:X,editingExpense:b}),e.jsx(he,{open:!!d,onOpenChange:s=>!s&&D(null),children:e.jsxs(pe,{children:[e.jsxs(fe,{children:[e.jsx(ge,{children:"–£–¥–∞–ª–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é?"}),e.jsx(je,{children:d&&e.jsxs(e.Fragment,{children:["–í—ã —É–≤–µ—Ä–µ–Ω—ã —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å ",d.type==="income"?"–¥–æ—Ö–æ–¥":"—Ä–∞—Å—Ö–æ–¥"," ",e.jsx("span",{className:"font-semibold",children:E(d.amount)})," ","(",d.category,")?",e.jsx("br",{}),"–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –±—É–¥–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å."]})})]}),e.jsxs(ve,{children:[e.jsx(we,{children:"–û—Ç–º–µ–Ω–∞"}),e.jsx(ye,{onClick:ee,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"–£–¥–∞–ª–∏—Ç—å"})]})]})})]})};export{Be as default};
