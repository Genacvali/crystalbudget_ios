import{k as Y,i as ee,r,s as m,j as e,L as g}from"./index-BczRz4ky.js";import{C,c as S,d as P,e as M,a as E,g as A,B as d,f as se}from"./crystal-icon-BR5-Rl_Z.js";import{L as o,I as c}from"./label-03Zcm6W0.js";import{T as ae,a as te,b as Z,c as $}from"./tabs-US1_3Bsj.js";import{s as L,Z as x}from"./types-Cqx1EfL_.js";const T=L().email("Неверный формат email"),F=L().min(6,"Пароль должен содержать минимум 6 символов"),ce=()=>{const u=Y(),{toast:t}=ee(),[n,l]=r.useState(!1),[H,f]=r.useState(!1),[j,q]=r.useState(!1),[V,k]=r.useState("login"),[v,W]=r.useState(""),[w,_]=r.useState(""),[h,U]=r.useState(""),[y,R]=r.useState(""),[N,D]=r.useState(""),[b,z]=r.useState(""),[p,G]=r.useState(""),[I,J]=r.useState("");r.useEffect(()=>{if(new URLSearchParams(window.location.hash.substring(1)).get("type")==="recovery"){q(!0);return}m.auth.getSession().then(({data:{session:a}})=>{a&&!j&&u("/")})},[u,j]);const K=async s=>{s.preventDefault();try{T.parse(v),F.parse(w)}catch(a){if(a instanceof x){t({title:"Ошибка валидации",description:a.errors[0].message,variant:"destructive"});return}}l(!0);const{error:i}=await m.auth.signInWithPassword({email:v,password:w});i?t({title:"Ошибка входа",description:i.message==="Invalid login credentials"?"Неверный email или пароль":i.message,variant:"destructive"}):(t({title:"Успешный вход",description:"Добро пожаловать!"}),u("/")),l(!1)},O=async s=>{s.preventDefault();try{T.parse(h),F.parse(y),L().min(1,"Имя обязательно").parse(N)}catch(B){if(B instanceof x){t({title:"Ошибка валидации",description:B.errors[0].message,variant:"destructive"});return}}l(!0);const i=`${window.location.origin}/`,{error:a}=await m.auth.signUp({email:h,password:y,options:{emailRedirectTo:i,data:{full_name:N}}});a?t({title:"Ошибка регистрации",description:a.message==="User already registered"?"Пользователь с таким email уже зарегистрирован":a.message,variant:"destructive"}):(t({title:"Регистрация успешна",description:"Проверьте вашу почту и подтвердите аккаунт для входа в приложение. Письмо с подтверждением было отправлено на "+h,duration:1e4}),U(""),R(""),D(""),k("login")),l(!1)},Q=async s=>{s.preventDefault();try{T.parse(b)}catch(a){if(a instanceof x){t({title:"Ошибка валидации",description:a.errors[0].message,variant:"destructive"});return}}l(!0);const{error:i}=await m.auth.resetPasswordForEmail(b,{redirectTo:`${window.location.origin}/auth`});i?t({title:"Ошибка",description:i.message,variant:"destructive"}):(t({title:"Письмо отправлено",description:"Проверьте вашу почту для восстановления пароля"}),f(!1)),l(!1)},X=async s=>{if(s.preventDefault(),p!==I){t({title:"Ошибка",description:"Пароли не совпадают",variant:"destructive"});return}try{F.parse(p)}catch(a){if(a instanceof x){t({title:"Ошибка валидации",description:a.errors[0].message,variant:"destructive"});return}}l(!0);const{error:i}=await m.auth.updateUser({password:p});i?t({title:"Ошибка",description:i.message,variant:"destructive"}):(t({title:"Пароль обновлен",description:"Ваш пароль успешно изменен"}),q(!1),u("/")),l(!1)};return j?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-background to-secondary/20 p-4",children:e.jsxs(C,{className:"w-full max-w-md",children:[e.jsxs(S,{children:[e.jsx(P,{children:"Создать новый пароль"}),e.jsx(M,{children:"Введите новый пароль для вашего аккаунта"})]}),e.jsxs("form",{onSubmit:X,children:[e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"new-password",children:"Новый пароль"}),e.jsx(c,{id:"new-password",type:"password",placeholder:"••••••",value:p,onChange:s=>G(s.target.value),required:!0,className:"input-smooth"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"confirm-password",children:"Подтвердите пароль"}),e.jsx(c,{id:"confirm-password",type:"password",placeholder:"••••••",value:I,onChange:s=>J(s.target.value),required:!0,className:"input-smooth"})]})]}),e.jsx(A,{children:e.jsxs(d,{type:"submit",className:"w-full btn-primary-smooth",disabled:n,children:[n&&e.jsx(g,{className:"mr-2 h-4 w-4 spinner-smooth"}),"Обновить пароль"]})})]})]})}):H?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-background to-secondary/20 p-4",children:e.jsxs(C,{className:"w-full max-w-md",children:[e.jsxs(S,{children:[e.jsx(P,{children:"Восстановление пароля"}),e.jsx(M,{children:"Введите ваш email для получения ссылки восстановления"})]}),e.jsxs("form",{onSubmit:Q,children:[e.jsx(E,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"reset-email",children:"Email"}),e.jsx(c,{id:"reset-email",type:"email",placeholder:"your@email.com",value:b,onChange:s=>z(s.target.value),required:!0,className:"input-smooth"})]})}),e.jsxs(A,{className:"flex flex-col space-y-2",children:[e.jsxs(d,{type:"submit",className:"w-full btn-primary-smooth",disabled:n,children:[n&&e.jsx(g,{className:"mr-2 h-4 w-4 spinner-smooth"}),"Отправить ссылку"]}),e.jsx(d,{type:"button",variant:"ghost",className:"w-full btn-secondary-smooth",onClick:()=>f(!1),children:"Назад ко входу"})]})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-background to-secondary/20 p-4",children:e.jsxs(C,{className:"w-full max-w-md card-smooth",children:[e.jsxs(S,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:se,alt:"CrystalBudget",className:"w-20 h-20 hover-scale icon-smooth"})}),e.jsx(P,{className:"text-2xl font-bold text-gradient-smooth",children:"CrystalBudget"})]}),e.jsx(E,{children:e.jsxs(ae,{value:V,onValueChange:k,className:"w-full",children:[e.jsxs(te,{className:"grid w-full grid-cols-2",children:[e.jsx(Z,{value:"login",children:"Вход"}),e.jsx(Z,{value:"signup",children:"Регистрация"})]}),e.jsx($,{value:"login",children:e.jsxs("form",{onSubmit:K,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"login-email",children:"Email"}),e.jsx(c,{id:"login-email",type:"email",placeholder:"your@email.com",value:v,onChange:s=>W(s.target.value),required:!0,className:"input-smooth"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"login-password",children:"Пароль"}),e.jsx(c,{id:"login-password",type:"password",placeholder:"••••••",value:w,onChange:s=>_(s.target.value),required:!0,className:"input-smooth"})]}),e.jsxs(d,{type:"submit",className:"w-full btn-primary-smooth",disabled:n,children:[n&&e.jsx(g,{className:"mr-2 h-4 w-4 spinner-smooth"}),"Войти"]}),e.jsx(d,{type:"button",variant:"link",className:"w-full btn-secondary-smooth",onClick:()=>f(!0),children:"Забыли пароль?"})]})}),e.jsx($,{value:"signup",children:e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"signup-name",children:"Имя"}),e.jsx(c,{id:"signup-name",type:"text",placeholder:"Иван Иванов",value:N,onChange:s=>D(s.target.value),required:!0,className:"input-smooth"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"signup-email",children:"Email"}),e.jsx(c,{id:"signup-email",type:"email",placeholder:"your@email.com",value:h,onChange:s=>U(s.target.value),required:!0,className:"input-smooth"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"signup-password",children:"Пароль"}),e.jsx(c,{id:"signup-password",type:"password",placeholder:"••••••",value:y,onChange:s=>R(s.target.value),required:!0,className:"input-smooth"})]}),e.jsxs(d,{type:"submit",className:"w-full btn-primary-smooth",disabled:n,children:[n&&e.jsx(g,{className:"mr-2 h-4 w-4 spinner-smooth"}),"Зарегистрироваться"]})]})})]})})]})})};export{ce as default};
